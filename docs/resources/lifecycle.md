---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cml2_lifecycle Resource - terraform-provider-cml2"
subcategory: ""
description: |-
  A lifecycle resource represents a complete CML lab lifecyle, including configuration injection and staged node launches.  Resulting state also includes IP addresses of nodes which have external connectivity. This is a synthetic resource which "glues" other actual resources like labs, nodes and links together.
---

# cml2_lifecycle (Resource)

A lifecycle resource represents a complete CML lab lifecyle, including configuration injection and staged node launches.  Resulting state also includes IP addresses of nodes which have external connectivity. This is a synthetic resource which "glues" other actual resources like labs, nodes and links together.

## Example Usage

```terraform
resource "cml2_lab" "this" {
  title       = "fancy lab title"
  description = "extra description"
  notes       = <<-EOT
  # Heading
  - topic one
  - topic two
  EOT
}

resource "cml2_node" "ext" {
  lab_id         = cml2_lab.this.id
  label          = "Internet"
  configuration  = "bridge0"
  nodedefinition = "external_connector"
  x              = -100
  y              = 0
  tags           = ["infra"]
}

resource "cml2_node" "ums1" {
  lab_id         = cml2_lab.this.id
  label          = "UMS1"
  nodedefinition = "unmanaged_switch"
  ram            = 512
  x              = 0
  y              = 0
  tags           = ["infra"]
}

resource "cml2_node" "r1" {
  lab_id         = cml2_lab.this.id
  label          = "R1"
  nodedefinition = "alpine"
  ram            = 512
  x              = 100
  y              = 0
  tags           = ["group1"]
}

resource "cml2_node" "r2" {
  lab_id         = cml2_lab.this.id
  label          = "R2"
  nodedefinition = "alpine"
  x              = 100
  y              = 130
  tags           = ["group2"]
}

resource "cml2_node" "r3" {
  lab_id         = cml2_lab.this.id
  label          = "R3"
  nodedefinition = "alpine"
  x              = -100
  y              = 130
}

resource "cml2_link" "l0" {
  lab_id      = cml2_lab.this.id
  node_a      = cml2_node.ext.id
  node_b      = cml2_node.ums1.id
  node_b_slot = 31
}

resource "cml2_link" "l1" {
  lab_id = cml2_lab.this.id
  node_a = cml2_node.r1.id
  node_b = cml2_node.ums1.id
  # node_a_slot = 3
  # node_b_slot = 31
}

resource "cml2_link" "l2" {
  lab_id = cml2_lab.this.id
  node_a = cml2_node.r2.id
  node_b = cml2_node.ums1.id
}

resource "cml2_link" "l3" {
  lab_id = cml2_lab.this.id
  node_a = cml2_node.r3.id
  node_b = cml2_node.ums1.id
}

resource "cml2_link" "l4" {
  lab_id = cml2_lab.this.id
  node_a = cml2_node.r2.id
  node_b = cml2_node.r3.id
}

resource "cml2_lifecycle" "top" {
  lab_id = cml2_lab.this.id
  # the elements list has the dependencies
  elements = [
    cml2_node.ext.id,
    cml2_node.ums1.id,
    cml2_node.r1.id,
    cml2_node.r2.id,
    cml2_node.r3.id,
    cml2_link.l0.id,
    cml2_link.l1.id,
    cml2_link.l2.id,
    cml2_link.l3.id,
    cml2_link.l4.id,
  ]
  staging = {
    stages          = ["infra", "group1"]
    start_remaining = false
  }
  # state = "STARTED"
}

output "r1_ip_address" {
  value = (
    cml2_lifecycle.top.nodes[cml2_node.r1.id].interfaces[0].ip4 == null ?
    "undefined" : (
      length(cml2_lifecycle.top.nodes[cml2_node.r1.id].interfaces[0].ip4) > 0 ?
      cml2_lifecycle.top.nodes[cml2_node.r1.id].interfaces[0].ip4[0] :
      "no ip"
    )
  )
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `configs` (Map of String) Map of node configurations to store into nodes, the key is the label of the node, the value is the node configuration.
- `elements` (List of String) List of node and link IDs the lab consists of. Works only when a (lab) ID is provided and no topology is configured.
- `lab_id` (String) Lab identifier, a UUID. If set, `elements` must be configured as well.
- `staging` (Attributes) Defines in what sequence nodes are launched. (see [below for nested schema](#nestedatt--staging))
- `state` (String) Lab state, one of `DEFINED_ON_CORE`, `STARTED` or `STOPPED`.
- `timeouts` (Attributes) Timeouts for operations, given as a parsable string as in `60m` or `2h`. (see [below for nested schema](#nestedatt--timeouts))
- `topology` (String, Sensitive) The topology to start, must be valid YAML. Can't be configured if the lab `id` is configured.
- `wait` (Boolean) If set to `true` then wait until the lab has completely `BOOTED`.

### Read-Only

- `booted` (Boolean) Set to `true` when all nodes in the lab have booted.
- `id` (String) Resource identifier, a UUID.
- `nodes` (Attributes Map) List of nodes and their interfaces with IP addresses. (see [below for nested schema](#nestedatt--nodes))

<a id="nestedatt--staging"></a>
### Nested Schema for `staging`

Required:

- `stages` (List of String) Ordered list of node tags, controls node launch. Nodes currently not launched will be launched in the stage with the matching tag. Tags must match exactly.

Optional:

- `start_remaining` (Boolean) If set to `true` (which is the default) then all nodes which are not matched by the stages list and which are still unstarted after running all stages will be started.


<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Required:

- `create` (String) Create timeout.
- `update` (String) Update timeout.

Optional:

- `delete` (String) Delete timeout (currently unused).


<a id="nestedatt--nodes"></a>
### Nested Schema for `nodes`

Required:

- `lab_id` (String) Lab ID containing the node (UUID).
- `label` (String) Node label.
- `nodedefinition` (String) Node definition / type. This can only be set at create time.

Optional:

- `boot_disk_size` (Number) Size of boot disk volume, in GB. Can be changed until the node is started once. Will require a replace in that case.
- `configuration` (String) Node configuration. Can be changed until the node is started once. Will require a replace in that case.
- `cpu_limit` (Number) CPU limit in %, 20-100. Can be changed until the node is started once. Will require a replace in that case.
- `cpus` (Number) Number of CPUs. Can be changed until the node is started once. Will require a replace in that case.
- `data_volume` (Number) Size of data volume, in GB. Can be changed until the node is started once. Will require a replace in that case.
- `imagedefinition` (String) Image definition, must match the node type. Can be changed until the node is started once. Will require a replace in that case.
- `ram` (Number) Amount of RAM, megabytes. Can be changed until the node is started once. Will require a replace in that case.
- `tags` (List of String) List of tags of the node.
- `x` (Number) X coordinate on the topology canvas.
- `y` (Number) Y coordinate on the topology canvas.

Read-Only:

- `compute_id` (String) ID of a compute this node is on, a UUID4.
- `id` (String) Node ID (UUID).
- `interfaces` (Attributes List) List of interfaces on the node. (see [below for nested schema](#nestedatt--nodes--interfaces))
- `serial_devices` (List of Object) List of serial devices (consoles). (see [below for nested schema](#nestedatt--nodes--serial_devices))
- `state` (String) Node state (`DEFINED_ON_CORE`, `STOPPED`, `STARTED`, `BOOTED`).
- `vnc_key` (String) VNC key of console, a UUID4.

<a id="nestedatt--nodes--interfaces"></a>
### Nested Schema for `nodes.interfaces`

Read-Only:

- `id` (String) Interface ID (UUID).
- `ip4` (List of String) IPv4 address list.
- `ip6` (List of String) IPv6 address list.
- `is_connected` (Boolean) Is the interface connected to a link?
- `label` (String) Interface label.
- `mac_address` (String) MAC address.
- `state` (String) interface state (`UP` or `DOWN`).


<a id="nestedatt--nodes--serial_devices"></a>
### Nested Schema for `nodes.serial_devices`

Read-Only:

- `console_key` (String)
- `device_number` (Number)


